<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–∏–±–ª–∏–æ—Ç–µ—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (—Å –æ—à–∏–±–∫–∞–º–∏)</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        overflow: hidden;
      }

      header {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 300;
      }

      .warning {
        background: #fff3cd;
        color: #856404;
        padding: 15px;
        border: 1px solid #ffeaa7;
        border-radius: 5px;
        margin: 10px 0;
        text-align: center;
        font-weight: bold;
      }

      .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        padding: 30px;
      }

      .section {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 25px;
        border-left: 4px solid #3498db;
      }

      .btn {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 5px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
      }

      .btn-danger {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      }

      .btn-success {
        background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
      }

      .results {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
        border: 1px solid #e9ecef;
        max-height: 300px;
        overflow-y: auto;
      }

      pre {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 20px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        line-height: 1.4;
        overflow-x: auto;
        max-height: 400px;
        overflow-y: auto;
      }

      .alert {
        padding: 12px 15px;
        border-radius: 8px;
        margin: 10px 0;
        font-weight: 500;
      }

      .alert-success {
        background: #d5f4e6;
        color: #27ae60;
        border: 1px solid #a3e4c1;
      }

      .alert-error {
        background: #fdebd0;
        color: #e67e22;
        border: 1px solid #fad7a0;
      }

      .alert-danger {
        background: #fadbd8;
        color: #e74c3c;
        border: 1px solid #f5b7b1;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>‚ö†Ô∏è –ë–∏–±–ª–∏–æ—Ç–µ—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (—Å –æ—à–∏–±–∫–∞–º–∏)</h1>
        <p class="subtitle">–í–µ—Ä—Å–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</p>
      </header>

      <div class="warning">
        ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–∞ –≤–µ—Ä—Å–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–µ–¥–Ω–∞–º–µ—Ä–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤
      </div>

      <div class="main-content">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="left-column">
          <!-- –ü–æ–∏—Å–∫ –∫–Ω–∏–≥ -->
          <div class="section">
            <h2>üîç –ü–æ–∏—Å–∫ –∫–Ω–∏–≥</h2>
            <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–≤—Ç–æ—Ä–∞ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ">
            <button class="btn" onclick="searchBooks()">–ü–æ–∏—Å–∫</button>
            <button class="btn btn-danger" onclick="stressTest()">üí• –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</button>
            <div class="results" id="searchResults"></div>
          </div>

          <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∞–º–∏ -->
          <div class="section">
            <h2>‚ö° –î–µ–π—Å—Ç–≤–∏—è —Å –∫–Ω–∏–≥–∞–º–∏</h2>
            <button class="btn btn-success" onclick="borrowBook()">–ê–ª–∏—Å–∞ –±–µ—Ä–µ—Ç –∫–Ω–∏–≥—É "1984"</button>
            <button class="btn btn-danger" onclick="returnBook()">–ê–ª–∏—Å–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–Ω–∏–≥—É</button>
            <button class="btn" onclick="testMemoryLeak()">üß™ –¢–µ—Å—Ç —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏</button>
            <div class="results" id="actionResults"></div>
          </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="right-column">
          <!-- –û—Ç—á–µ—Ç -->
          <div class="section">
            <h2>üìä –û—Ç—á–µ—Ç</h2>
            <button class="btn" onclick="generateReport()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç</button>
            <button class="btn" onclick="clearCache()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</button>
            <pre id="reportOutput">–ù–∞–∂–º–∏—Ç–µ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç" –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞...</pre>
          </div>

          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
          <div class="section">
            <h2>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <div class="alert alert-error">
              ‚ÑπÔ∏è –°–∏—Å—Ç–µ–º–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–µ–¥–Ω–∞–º–µ—Ä–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            </div>
            <div id="memoryInfo">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: -</div>
            <div id="performanceInfo">–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: -</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // –û–®–ò–ë–ö–ê 1: –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏
      let memoryLeakData = [];
      let searchCache = new Map(); // –ö—ç—à –∫–æ—Ç–æ—Ä—ã–π –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è

      class Book {
        constructor(id, title, author, year, available = true) {
          this.id = id;
          this.title = title;
          this.author = author;
          this.year = year;
          this.available = available;
        }

        toString() {
          return `${this.title} (${this.year}) by ${this.author} [${this.available ? '–≤ –Ω–∞–ª–∏—á–∏–∏' : '–≤—ã–¥–∞–Ω–∞'}]`;
        }
      }

      class User {
        constructor(id, name) {
          this.id = id;
          this.name = name;
          this.borrowedBooks = [];
        }

        borrowBook(book) {
          if (!book) {
            throw new Error('Book is undefined');
          }
          if (!book.available) {
            throw new Error(`–ö–Ω–∏–≥–∞ "${book.title}" —É–∂–µ –≤—ã–¥–∞–Ω–∞`);
          }
          book.available = false;
          this.borrowedBooks.push(book);

          // –û–®–ò–ë–ö–ê 1: –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –æ–ø–µ—Ä–∞—Ü–∏–π
          memoryLeakData.push({
            type: 'borrow',
            user: this.name,
            book: book.title,
            timestamp: Date.now(),
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —É—Ç–µ—á–∫–∏
            extraData: new Array(100).fill('leak').join('')
          });
        }

        returnBook(book) {
          if (!book) {
            throw new Error('Book is undefined');
          }
          const index = this.borrowedBooks.indexOf(book);
          if (index === -1) {
            throw new Error(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±—Ä–∞–ª –∫–Ω–∏–≥—É "${book.title}"`);
          }
          this.borrowedBooks.splice(index, 1);
          book.available = true;

          // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —É—Ç–µ—á–∫—É –ø–∞–º—è—Ç–∏
          memoryLeakData.push({
            type: 'return',
            user: this.name,
            book: book.title,
            timestamp: Date.now(),
            extraData: new Array(100).fill('leak').join('')
          });
        }

        getBorrowedTitles() {
          return this.borrowedBooks.map(b => b.title);
        }
      }

      class Library {
        constructor() {
          this.books = [];
          this.users = [];
        }

        addBook(book) {
          this.books.push(book);
        }

        addUser(user) {
          this.users.push(user);
        }

        findBookById(id) {
          return this.books.find(b => b.id === id);
        }

        findUserById(id) {
          return this.users.find(u => u.id === id);
        }

        searchBooks(query) {
          if (!query || typeof query !== 'string') {
            return [];
          }

          // –û–®–ò–ë–ö–ê 2: –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∫—ç—à (–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è)
          if (searchCache.has(query)) {
            return searchCache.get(query);
          }

          // –û–®–ò–ë–ö–ê 3: –ü—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ - –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
          const startTime = performance.now();
          let result = 0;
          for (let i = 0; i < 10000; i++) {
            result += Math.sqrt(i) * Math.sin(i); // –ë–µ—Å–ø–æ–ª–µ–∑–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
          }

          const q = query.toLowerCase();
          const searchResult = this.books.filter(b =>
                  b.title.toLowerCase().includes(q) ||
                  b.author.toLowerCase().includes(q)
          );

          searchCache.set(query, searchResult);

          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É—Ç–µ—á–∫–∏
          memoryLeakData.push({
            type: 'search',
            query: query,
            results: searchResult.length,
            timestamp: Date.now()
          });

          return searchResult;
        }

        generateReport() {
          let report = "=== –û–¢–ß–Å–¢ –ë–ò–ë–õ–ò–û–¢–ï–ö–ò ===\n";

          // –û–®–ò–ë–ö–ê 3: –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º O(n^2)
          let totalComparisons = 0;
          for (let i = 0; i < this.books.length; i++) {
            for (let j = i; j < this.books.length; j++) {
              totalComparisons++;
              // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
              let temp = [];
              for (let k = 0; k < 100; k++) {
                temp.push(k * k);
              }
            }
          }

          for (const book of this.books) {
            const status = book.available ? "–í –Ω–∞–ª–∏—á–∏–∏" : "–í—ã–¥–∞–Ω–∞";
            report += `${book.id}. ${book.title} ‚Äî ${status}\n`;
          }
          report += `\n–í—Å–µ–≥–æ –∫–Ω–∏–≥: ${this.books.length}\n`;
          report += `–í—ã–¥–∞–Ω–æ: ${this.books.filter(b => !b.available).length}\n`;
          report += `–°—Ä–∞–≤–Ω–µ–Ω–∏–π –≤ –æ—Ç—á–µ—Ç–µ: ${totalComparisons}\n`;
          report += `–†–∞–∑–º–µ—Ä —É—Ç–µ—á–∫–∏: ${memoryLeakData.length} –∑–∞–ø–∏—Å–µ–π\n`;
          report += `–†–∞–∑–º–µ—Ä –∫—ç—à–∞: ${searchCache.size} –∑–∞–ø—Ä–æ—Å–æ–≤\n`;

          return report;
        }
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
      const lib = new Library();
      lib.addBook(new Book(1, "1984", "–î–∂–æ—Ä–¥–∂ –û—Ä—É—ç–ª–ª", 1949));
      lib.addBook(new Book(2, "–ú–∞—Å—Ç–µ—Ä –∏ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞", "–ú–∏—Ö–∞–∏–ª –ë—É–ª–≥–∞–∫–æ–≤", 1967));
      lib.addBook(new Book(3, "–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∏ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ", "–§. –î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π", 1866));

      lib.addUser(new User(101, "–ê–ª–∏—Å–∞"));
      lib.addUser(new User(102, "–ë–æ–±"));

      const user = lib.findUserById(101);
      const book = lib.findBookById(1);

      // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
      function searchBooks() {
        const query = document.getElementById('searchInput').value;
        const startTime = performance.now();

        const results = lib.searchBooks(query);
        const endTime = performance.now();

        document.getElementById('searchResults').innerHTML =
                results.map(b => `<div>${b.toString()}</div>`).join('') +
                `<div class="alert alert-info">–í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞: ${(endTime - startTime).toFixed(2)}ms</div>`;

        updateMemoryInfo();
      }

      function borrowBook() {
        try {
          user.borrowBook(book);
          document.getElementById('actionResults').innerHTML =
                  `<div class="alert alert-success">${user.name} –≤–∑—è–ª: ${book.title}</div>`;
          updateMemoryInfo();
        } catch (e) {
          document.getElementById('actionResults').innerHTML =
                  `<div class="alert alert-danger">–û—à–∏–±–∫–∞: ${e.message}</div>`;
        }
      }

      function returnBook() {
        try {
          user.returnBook(book);
          document.getElementById('actionResults').innerHTML =
                  `<div class="alert alert-success">${user.name} –≤–µ—Ä–Ω—É–ª: ${book.title}</div>`;
          updateMemoryInfo();
        } catch (e) {
          document.getElementById('actionResults').innerHTML =
                  `<div class="alert alert-danger">–û—à–∏–±–∫–∞: ${e.message}</div>`;
        }
      }

      function generateReport() {
        const startTime = performance.now();
        document.getElementById('reportOutput').textContent = lib.generateReport();
        const endTime = performance.now();

        document.getElementById('performanceInfo').textContent =
                `–í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞: ${(endTime - startTime).toFixed(2)}ms`;
        updateMemoryInfo();
      }

      function stressTest() {
        const startTime = performance.now();
        let operations = 0;

        // –°–æ–∑–¥–∞–µ–º –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ CPU –∏ –ø–∞–º—è—Ç—å
        for (let i = 0; i < 1000; i++) {
          lib.searchBooks("test" + i);
          operations++;

          // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É—Ç–µ—á–∫–∏
          if (i % 100 === 0) {
            memoryLeakData.push({
              type: 'stress_test',
              iteration: i,
              data: new Array(1000).fill('stress_data').join('')
            });
          }
        }

        const endTime = performance.now();
        document.getElementById('actionResults').innerHTML =
                `<div class="alert alert-info">
                    Stress test –∑–∞–≤–µ—Ä—à–µ–Ω<br>
                    –û–ø–µ—Ä–∞—Ü–∏–π: ${operations}<br>
                    –í—Ä–µ–º—è: ${(endTime - startTime).toFixed(2)}ms<br>
                    –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏: ${memoryLeakData.length} –∑–∞–ø–∏—Å–µ–π
                </div>`;
        updateMemoryInfo();
      }

      function testMemoryLeak() {
        // –°–æ–∑–¥–∞–µ–º —É—Ç–µ—á–∫—É –ø–∞–º—è—Ç–∏
        for (let i = 0; i < 500; i++) {
          memoryLeakData.push({
            type: 'memory_leak_test',
            id: i,
            largeData: new Array(500).fill('leak_data_' + i).join(''),
            timestamp: Date.now()
          });
        }

        document.getElementById('actionResults').innerHTML =
                `<div class="alert alert-danger">
                    ‚úÖ –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ —Å–æ–∑–¥–∞–Ω–∞<br>
                    –î–æ–±–∞–≤–ª–µ–Ω–æ 500 –∑–∞–ø–∏—Å–µ–π –≤ memoryLeakData<br>
                    –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä —É—Ç–µ—á–∫–∏: ${memoryLeakData.length} –∑–∞–ø–∏—Å–µ–π
                </div>`;
        updateMemoryInfo();
      }

      function clearCache() {
        searchCache.clear();
        document.getElementById('actionResults').innerHTML =
                `<div class="alert alert-success">–ö—ç—à –æ—á–∏—â–µ–Ω</div>`;
        updateMemoryInfo();
      }

      function updateMemoryInfo() {
        document.getElementById('memoryInfo').textContent =
                `–£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏: ${memoryLeakData.length} –∑–∞–ø–∏—Å–µ–π | –ö—ç—à: ${searchCache.size} –∑–∞–ø—Ä–æ—Å–æ–≤`;
      }

      // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏
      window.lib = lib;
      window.user = user;
      window.book = book;
      window.memoryLeakData = memoryLeakData;
      window.searchCache = searchCache;

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      document.addEventListener('DOMContentLoaded', function() {
        updateMemoryInfo();
      });
    </script>
  </body>
</html>